<pre>// Copyright Epic Games, Inc. All Rights Reserved.

#include "Importer.h"
#include "LightmassSwarm.h"
#include "LightmassScene.h"
#include "Misc/FileHelper.h"
#include "Misc/SecureHash.h"
</pre><pre style="background:#ccffcc;">
// Extensibility+: Begin
#include "Modules/ModuleManager.h"
namespace Lightmass
{
	bool FLightmassImporter::ImportCustomData(FScene&amp; Scene)
	{
		TArray&lt;TCHAR&gt; ModuleStr;
		int32 NumModuleStr;
		ImportData(&amp;NumModuleStr);
		if (NumModuleStr) ImportArray(ModuleStr, NumModuleStr);

		TArray&lt;FString&gt; Modules;
		FString(ModuleStr.Num(), ModuleStr.GetData()).ParseIntoArray(Modules, TEXT(" "));
		for (const FString&amp; Pair : Modules)
		{
			FString Plugin, Module;
			check(Pair.Split(TEXT(":"), &amp;Plugin, &amp;Module));
			FModuleManager::LoadModuleChecked&lt;ICustomLightmassImporter&gt;(*Module).Import(*this, Scene);
		}
		return true;
	}
}
// Extensibility+: End

</pre><pre>namespace Lightmass
{

FLightmassImporter::FLightmassImporter( FLightmassSwarm* InSwarm )
:	Swarm( InSwarm )
,	LevelScale(0.0f)
{
	// Compute the hash of UnrealLightmass executable (which is the current running process) and store it into LightmassExecutableHash
	TArray&lt;uint8&gt; Bytes;
	FFileHelper::LoadFileToArray(Bytes, FPlatformProcess::ExecutablePath());
	FSHA1::HashBuffer(&amp;Bytes[0], Bytes.Num(), LightmassExecutableHash.Hash);
}

FLightmassImporter::~FLightmassImporter()
{
}

/**
 * Imports a scene and all required dependent objects
 *
 * @param Scene Scene object to fill out
 * @param SceneGuid Guid of the scene to load from a swarm channel
 */
bool FLightmassImporter::ImportScene( class FScene&amp; Scene, const FGuid&amp; SceneGuid )
{
	int32 ErrorCode = Swarm-&gt;OpenChannel( *CreateChannelName( SceneGuid, LM_SCENE_VERSION, LM_SCENE_EXTENSION ), LM_SCENE_CHANNEL_FLAGS, true );
	if( ErrorCode &gt;= 0 )
	{
		Scene.Import( *this );

		Swarm-&gt;CloseCurrentChannel( );
		return true;
	}
	else
	{
		Swarm-&gt;SendTextMessage( TEXT( "Failed to open scene channel with GUID {%08x}:{%08x}:{%08x}:{%08x}" ), SceneGuid.A, SceneGuid.B, SceneGuid.C, SceneGuid.D );
	}

	return false;
}

bool FLightmassImporter::Read( void* Data, int32 NumBytes )
{
	int32 NumRead = Swarm-&gt;Read(Data, NumBytes);
	return NumRead == NumBytes;
}

}	//Lightmass
</pre>