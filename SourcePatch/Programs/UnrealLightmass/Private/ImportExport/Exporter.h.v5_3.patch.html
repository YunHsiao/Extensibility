<pre>// Copyright Epic Games, Inc. All Rights Reserved.

#pragma once

#include "CoreMinimal.h"
#include "LMCore.h"
#include "Containers/IndirectArray.h"


namespace Lightmass
{
	class FScene;
	class FMeshAreaLight;
	class FLightmassSwarm;
	class FStaticLightingTextureMappingResult;
	class FStaticLightingVertexMappingResult;

	//@todo - need to pass to Serialization
	class FLightmassSolverExporter
	{
	public:

		/**
		 * Constructor
		 * @param InSwarm Wrapper object around the Swarm interface
		 * @param bInDumpTextures If true, the 2d lightmap exporter will dump out textures
		 */
		FLightmassSolverExporter( class FLightmassSwarm* InSwarm, const FScene&amp; InScene, bool bInDumpTextures );
		~FLightmassSolverExporter();

		class FLightmassSwarm* GetSwarm();

		/**
		 * Send complete lighting data to Unreal
		 *
		 * @param LightingData - Object containing the computed data
		 */
		void ExportResults(struct FTextureMappingStaticLightingData&amp; LightingData, bool bUseUniqueChannel) const;
		void ExportResults(const struct FPrecomputedVisibilityData&amp; TaskData) const;
		void ExportResults(const struct FVolumetricLightmapTaskData&amp; TaskData) const;
</pre><pre style="background:#ccffcc;">
		// Extensibility+: Begin
		template&lt;typename DataType&gt;
		void ExportResults(const DataType&amp; TaskData) const
		{
			TaskData.Export(Swarm);
		}
		// Extensibility+: End

</pre><pre>		/**
		 * Used when exporting multiple mappings into a single file
		 */
		int32 BeginExportResults(struct FTextureMappingStaticLightingData&amp; LightingData, uint32 NumMappings) const;
		void EndExportResults() const;

		/** Exports volume lighting samples to Unreal. */
		void ExportVolumeLightingSamples(
			bool bExportVolumeLightingDebugOutput,
			const struct FVolumeLightingDebugOutput&amp; DebugOutput,
			const FVector4f&amp; VolumeCenter, 
			const FVector4f&amp; VolumeExtent, 
			const TMap&lt;FGuid,TArray&lt;class FVolumeLightingSample&gt; &gt;&amp; VolumeSamples) const;

		/** Exports dominant shadow information to Unreal. */
		void ExportStaticShadowDepthMap(const FGuid&amp; LightGuid, const class FStaticShadowDepthMap&amp; StaticShadowDepthMap) const;

		/** 
		 * Exports information about mesh area lights back to Unreal, 
		 * So that Unreal can create dynamic lights to approximate the mesh area light's influence on dynamic objects.
		 */
		void ExportMeshAreaLightData(const class TIndirectArray&lt;FMeshAreaLight&gt;&amp; MeshAreaLights, float MeshAreaLightGeneratedDynamicLightSurfaceOffset) const;

		/** Exports the volume distance field. */
		void ExportVolumeDistanceField(int32 VolumeSizeX, int32 VolumeSizeY, int32 VolumeSizeZ, float VolumeMaxDistance, const FBox3f&amp; DistanceFieldVolumeBounds, const TArray&lt;FColor&gt;&amp; VolumeDistanceField) const;

	private:
		class FLightmassSwarm*	Swarm;
		const class FScene&amp; Scene;

		/** true if the exporter should dump out textures to disk for previewing */
		bool bDumpTextures;

		/** Writes a TArray to the channel on the top of the Swarm stack. */
		template&lt;class T&gt;
		void WriteArray(const TArray&lt;T&gt;&amp; Array) const;

		void WriteDebugLightingOutput(const struct FDebugLightingOutput&amp; DebugOutput) const;
	};

}	//Lightmass
</pre>